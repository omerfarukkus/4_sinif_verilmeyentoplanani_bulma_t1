<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verilmeyen Toplananı Bulma</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0f4f8; /* Açık mavi-gri arka plan */
            color: #333;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .game-frame {
            background: #ffffff; /* Beyaz çerçeve */
            border-radius: 2.5rem;
            padding: 0.75rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }
        .game-board {
            background-color: #ffffff; /* Beyaz tahta */
            border-radius: 2rem;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            border: 2px solid #cbd5e1; /* Kenarlık Eklendi */
            /* Matematik defteri kareleri */
            background-image:
                linear-gradient(rgba(204, 214, 224, 0.5) 1px, transparent 1px),
                linear-gradient(90deg, rgba(204, 214, 224, 0.5) 1px, transparent 1px);
            background-size: 25px 25px;
        }
        .problem-text {
            font-size: 5rem;
            line-height: 1;
            letter-spacing: 2px;
            font-weight: 900;
            color: #1e3a8a; /* Koyu mavi yazı */
        }
        .option-btn {
            width: 100%;
            padding: 1.25rem 0.75rem;
            border: none;
            border-radius: 1.25rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            font-size: 2rem;
            font-weight: 900;
            color: white;
            box-shadow: inset 0 -6px 0 rgba(0,0,0,0.2);
        }
        .option-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            filter: brightness(1.1);
        }
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        #feedback-alert {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); padding: 1rem 2rem;
            border-radius: 0.75rem; background-color: rgba(0, 0, 0, 0.7);
            font-size: 3rem; font-weight: 700; text-align: center;
            opacity: 0; transition: opacity 0.3s ease-in-out;
            pointer-events: none; z-index: 10;
            font-family: 'Quicksand', sans-serif; /* Yazı tipi değiştirildi */
        }
        .shake { animation: shake 0.5s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); } 20%, 40%, 60%, 80% { transform: translateX(8px); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="game-frame w-full max-w-sm mx-auto">
        <div id="game-container" class="game-board">
            
            <div id="feedback-alert"></div>

            <div class="flex justify-between items-center mb-6 text-xl">
                <div id="lives" class="flex items-center space-x-2 text-red-500"></div>
                <div id="question-counter" class="bg-gray-200 text-gray-700 text-sm font-bold rounded-full px-3 py-1">1/20</div>
            </div>

            <div id="problem-area" class="mb-8 text-center flex justify-center items-center" style="height: 168px;">
                <p id="question-text" class="problem-text" style="font-size: 2.75rem;"></p>
            </div>

            <div id="options-container" class="grid grid-cols-2 gap-4">
                <!-- Seçenek butonları buraya gelecek -->
            </div>
        </div>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4">
        <div class="game-frame max-w-sm w-full">
            <div class="bg-white rounded-2xl p-6 text-center">
                <h2 id="modal-title" class="text-4xl sm:text-5xl mb-4 font-black">Oyun Bitti!</h2>
                <p id="modal-message" class="text-xl sm:text-2xl mb-8">Tekrar denemek ister misin?</p>
                <button id="restart-btn" class="w-full py-3 text-2xl rounded-xl text-white bg-blue-500 hover:bg-blue-600 transition-colors font-bold" style="box-shadow: inset 0 -6px 0 rgba(0,0,0,0.2);">Yeniden Başla</button>
            </div>
        </div>
    </div>

    <script>
        const livesEl = document.getElementById('lives');
        const questionCounterEl = document.getElementById('question-counter');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const restartBtn = document.getElementById('restart-btn');
        const feedbackAlert = document.getElementById('feedback-alert');

        const TOTAL_QUESTIONS = 20;
        const INITIAL_LIVES = 4;
        const NUM_OPTIONS = 4;
        const OPTION_COLORS = ['#38bdf8', '#f472b6', '#4ade80', '#fbbf24']; // Mavi, Pembe, Yeşil, Sarı

        let questions = [];
        let currentQuestionIndex = 0;
        let lives = INITIAL_LIVES;
        let score = 0;
        let audioCtx;

        function initAudio() {
            if (!audioCtx) {
                try {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) { console.error("Web Audio API not supported."); }
            }
        }
        
        function playSound(type) {
            if (!audioCtx) return;
            const o = audioCtx.createOscillator(), g = audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination);
            g.gain.setValueAtTime(0.05, audioCtx.currentTime);
            if (type === 'correct') {
                o.type = 'sine'; o.frequency.setValueAtTime(800, audioCtx.currentTime);
                o.start(); o.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'incorrect') {
                o.type = 'square'; o.frequency.setValueAtTime(200, audioCtx.currentTime);
                o.start(); o.stop(audioCtx.currentTime + 0.2);
            }
        }
        
        function generateAllQuestions() {
            let allQuestions = [];
            
            for (let i = 0; i < TOTAL_QUESTIONS; i++) {
                // 1000-4000 arası bir ana sayı
                const num1 = Math.floor(Math.random() * 3001) + 1000; 
                // 100-900 arası bir eksik sayı (cevap)
                const num2 = Math.floor(Math.random() * 801) + 100;   
                const result = num1 + num2;
                // Soru formatını rastgele belirle: (num1 + ? = result) veya (? + num1 = result)
                const format = Math.random() < 0.5 ? 'knownFirst' : 'missingFirst';
                
                if (format === 'knownFirst') {
                    // Soru: num1 + ? = result
                    // Cevap: num2
                    allQuestions.push({
                        displayNum: num1,
                        answer: num2,
                        result: result,
                        format: 'knownFirst'
                    });
                } else {
                    // Soru: ? + num1 = result
                    // Cevap: num2
                    allQuestions.push({
                        displayNum: num1,
                        answer: num2,
                        result: result,
                        format: 'missingFirst'
                    });
                }
            }

            for (let i = allQuestions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allQuestions[i], allQuestions[j]] = [allQuestions[j], allQuestions[i]];
            }
            questions = allQuestions.slice(0, TOTAL_QUESTIONS);
        }

        function updateHUD() {
            livesEl.innerHTML = '';
            for (let i = 0; i < INITIAL_LIVES; i++) {
                const pencil = document.createElement('span');
                pencil.textContent = '✏️'; // Canlar kalem olarak değiştirildi
                pencil.style.transition = 'opacity 0.3s';
                pencil.style.opacity = i < lives ? '1' : '0.3';
                livesEl.appendChild(pencil);
            }
            questionCounterEl.textContent = `${currentQuestionIndex + 1}/${TOTAL_QUESTIONS}`;
        }

        function displayQuestion() {
            if (currentQuestionIndex >= questions.length) return;
            const q = questions[currentQuestionIndex];
            
            if (q.format === 'knownFirst') {
                questionTextEl.textContent = `${q.displayNum} + ? = ${q.result}`;
            } else {
                questionTextEl.textContent = `? + ${q.displayNum} = ${q.result}`;
            }
            
            generateOptions(q.answer);
            updateHUD();
        }
        
        function generateOptions(correctAnswer) {
            optionsContainer.innerHTML = '';
            let options = new Set([correctAnswer]);
            while(options.size < NUM_OPTIONS) {
                const deviation = Math.floor(Math.random() * 50) + 10;
                const wrongAnswer = correctAnswer + (Math.random() < 0.5 ? -deviation : deviation);
                if (wrongAnswer > 0) options.add(wrongAnswer);
            }
            const shuffledOptions = Array.from(options).sort(() => Math.random() - 0.5);
            shuffledOptions.forEach((option, index) => {
                const button = document.createElement('button');
                button.classList.add('option-btn');
                button.onclick = () => handleOptionClick(option, correctAnswer, button);
                button.style.backgroundColor = OPTION_COLORS[index];
                button.textContent = option;
                optionsContainer.appendChild(button);
            });
        }
        
        function showFeedback(isCorrect) {
            feedbackAlert.textContent = isCorrect ? 'Doğru!' : 'Yanlış!';
            feedbackAlert.style.color = isCorrect ? '#4ade80' : '#f472b6';
            feedbackAlert.style.opacity = '1';
            setTimeout(() => { feedbackAlert.style.opacity = '0'; }, 800);
        }

        function handleOptionClick(selectedAnswer, correctAnswer, clickedButton) {
            initAudio(); 
            const buttons = optionsContainer.querySelectorAll('button');
            buttons.forEach(btn => btn.disabled = true);

            if (selectedAnswer === correctAnswer) {
                score++;
                playSound('correct');
                showFeedback(true);
                setTimeout(nextQuestion, 1000);
            } else {
                lives--;
                optionsContainer.classList.add('shake');
                playSound('incorrect');
                showFeedback(false);
                
                buttons.forEach(btn => {
                    if (parseInt(btn.textContent) !== correctAnswer) {
                         btn.style.opacity = '0.5';
                    }
                });

                updateHUD();
                setTimeout(() => optionsContainer.classList.remove('shake'), 500);

                if (lives <= 0) {
                    setTimeout(() => endGame(false), 1500);
                } else {
                    setTimeout(nextQuestion, 2000);
                }
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex >= TOTAL_QUESTIONS) {
                endGame(true);
            } else {
                displayQuestion();
            }
        }

        function endGame(isWin) {
            modalTitle.textContent = isWin ? '🎉 Tebrikler! 🎉' : 'Oyun Bitti!';
            modalMessage.textContent = `Toplam ${TOTAL_QUESTIONS} sorudan ${score} tanesini doğru bildin!`;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }
        
        function startGame() {
            currentQuestionIndex = 0;
            lives = INITIAL_LIVES;
            score = 0;
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            generateAllQuestions();
            displayQuestion();
        }
        
        restartBtn.addEventListener('click', startGame);
        startGame();
    </script>
</body>
</html>

